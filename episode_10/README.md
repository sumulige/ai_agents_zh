# Episode 10: n8n Best Practices - Build Like a Pro

> AI Agents A-Z - ç”¨ n8n æ„å»ºå®ç”¨çš„ AI Agent
> éš¾åº¦: â­â­ | é¢„ä¼°æ—¶é—´: 30 åˆ†é’Ÿ

---

## [Level 1] è¿™ä¸€é›†åœ¨åšä»€ä¹ˆï¼Ÿ

æœ¬é›†æ€»ç»“ n8n çš„**æœ€ä½³å®è·µ**ï¼Œå¸®åŠ©ä½ æ„å»ºå¯ç»´æŠ¤ã€å¯æ‰©å±•çš„å·¥ä½œæµã€‚

**ä¸€å¥è¯**ï¼šåƒ"èµ„æ·±æ¶æ„å¸ˆ"ä¸€æ ·ï¼Œå­¦ä¹ ç»„ç»‡å·¥ä½œæµã€é¿å…å¸¸è§é™·é˜±ã€æå‡å¼€å‘æ•ˆç‡ã€‚

**é€‚ç”¨åœºæ™¯**ï¼š
- æ„å»ºå¤æ‚å·¥ä½œæµç³»ç»Ÿ
- å›¢é˜Ÿåä½œå¼€å‘ n8n
- ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

> ğŸ’¡ **å¿«é€Ÿåˆ¤æ–­**ï¼šå¦‚æœä½ æƒ³**å†™å‡ºä¸“ä¸šçº§çš„ n8n å·¥ä½œæµ**ï¼Œè¿™ä¸€é›†é€‚åˆä½ ã€‚
> æƒ³äº†è§£æ›´å¤šï¼Ÿç»§ç»­é˜…è¯» [Level 2]ã€‚

---

## [Level 2] æ ¸å¿ƒæ¦‚å¿µ

### ä½ ä¼šå­¦åˆ°ä»€ä¹ˆ

| åºå· | æ¦‚å¿µ | è¯´æ˜ |
|------|------|------|
| 1 | **å·¥ä½œæµç»„ç»‡** | ç»“æ„åŒ–æ–‡ä»¶å¤¹å’Œå‘½å |
| 2 | **å­å·¥ä½œæµæ¨¡å¼** | å¯å¤ç”¨ç»„ä»¶è®¾è®¡ |
| 3 | **ç¯å¢ƒå˜é‡ç®¡ç†** | å®‰å…¨é…ç½®ç®¡ç† |
| 4 | **é”™è¯¯å¤„ç†** | å¥å£®çš„å·¥ä½œæµè®¾è®¡ |
| 5 | **è°ƒè¯•æŠ€å·§** | é«˜æ•ˆé—®é¢˜æ’æŸ¥ |
| 6 | **æ€§èƒ½ä¼˜åŒ–** | æå‡æ‰§è¡Œæ•ˆç‡ |

### æœ€ä½³å®è·µåˆ†ç±»

| ç±»åˆ« | å…³é”®ç‚¹ |
|------|--------|
| **ç»„ç»‡** | æ–‡ä»¶å¤¹ç»“æ„ã€å‘½åè§„èŒƒ |
| **è®¾è®¡** | å­å·¥ä½œæµã€å•ä¸€èŒè´£ |
| **å®‰å…¨** | ç¯å¢ƒå˜é‡ã€å‡­è¯ç®¡ç† |
| **è´¨é‡** | æµ‹è¯•ã€é”™è¯¯å¤„ç† |
| **æ€§èƒ½** | ç¼“å­˜ã€å¹¶è¡Œå¤„ç† |

> ğŸ’¡ **äº†è§£å¤Ÿäº†ï¼Ÿ** çŸ¥é“å­¦ä»€ä¹ˆå°±å¯ä»¥å¼€å§‹ã€‚ç»§ç»­é˜…è¯» [Level 3] äº†è§£è¯¦æƒ…ã€‚

---

## [Level 3] å·¥ä½œæµç»„ç»‡

### æ¨èçš„æ–‡ä»¶å¤¹ç»“æ„

```
n8n-workflows/
â”œâ”€â”€ production/          # ç”Ÿäº§ç¯å¢ƒå·¥ä½œæµ
â”‚   â”œâ”€â”€ core/           # æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
â”‚   â”œâ”€â”€ integrations/   # å¤–éƒ¨é›†æˆ
â”‚   â””â”€â”€ scheduled/      # å®šæ—¶ä»»åŠ¡
â”œâ”€â”€ development/         # å¼€å‘ä¸­å·¥ä½œæµ
â”œâ”€â”€ templates/          # å¯å¤ç”¨æ¨¡æ¿
â”‚   â”œâ”€â”€ subworkflows/   # å­å·¥ä½œæµ
â”‚   â””â”€â”€ snippets/       # ä»£ç ç‰‡æ®µ
â””â”€â”€ tests/             # æµ‹è¯•å·¥ä½œæµ
```

### å‘½åè§„èŒƒ

**å·¥ä½œæµå‘½å**:
```
[ç¯å¢ƒ]-[ç³»ç»Ÿ]-[æ¨¡å—]-[åŠ¨ä½œ]

ç¤ºä¾‹:
prod-content-blog-publish
dev-social-queue-process
template-user-onboarding
```

**èŠ‚ç‚¹å‘½å**:
```
ä½¿ç”¨åŠ¨è¯ + åè¯ï¼Œæ¸…æ™°æè¿°åŠŸèƒ½

å¥½: Get user from database
å¥½: Generate summary with LLM
å·®: Node 1
å·®: Test
```

### å·¥ä½œæµç‰ˆæœ¬æ§åˆ¶

**ä½¿ç”¨ Git**:
```
# å¯¼å‡ºæ‰€æœ‰å·¥ä½œæµ
n8n export:all --output=workflows/

# æäº¤åˆ° Git
git add workflows/
git commit -m "feat: add blog publishing workflow"
```

### æ–‡æ¡£è§„èŒƒ

**æ¯ä¸ªå·¥ä½œæµåº”è¯¥æœ‰**:
1. ç®€çŸ­æè¿°
2. è¾“å…¥/è¾“å‡ºè¯´æ˜
3. ä¾èµ–å…³ç³»
4. ä¿®æ”¹å†å²

---

## [Level 4] æ„å»ºæœ€ä½³å®è·µ

### å­å·¥ä½œæµè®¾è®¡

**ä½•æ—¶ä½¿ç”¨å­å·¥ä½œæµ**:
- åŠŸèƒ½è¢«å¤šä¸ªå·¥ä½œæµä½¿ç”¨
- å¤æ‚é€»è¾‘éœ€è¦ç‹¬ç«‹æµ‹è¯•
- å·¥ä½œæµè¶…è¿‡ 50 ä¸ªèŠ‚ç‚¹

**å­å·¥ä½œæµæœ€ä½³å®è·µ**:
```javascript
// æ¸…æ™°çš„è¾“å…¥å‚æ•°
{
  "userId": "string (required)",
  "action": "enum (required)",
  "options": "object (optional)"
}

// è¿”å›æ ‡å‡†åŒ–è¾“å‡º
{
  "success": "boolean",
  "data": "object",
  "error": "string"
}
```

### é”™è¯¯å¤„ç†æ¨¡å¼

**1. ç»§ç»­æ‰§è¡Œæ¨¡å¼**:
```
[Node] â”€â”€ onError: continue â”€â”€â”€â–º [Log Error]
                                    â”‚
                                    â–¼
                              [Continue Flow]
```

**2. é‡è¯•æ¨¡å¼**:
```
[Node] â”€â”€ onError: retry (3x) â”€â”€â–º [Continue]
```

**3. é™çº§æ¨¡å¼**:
```
[Primary API] â”€â”€ fail â”€â”€â–º [Fallback API]
```

### ç¯å¢ƒå˜é‡ç®¡ç†

**ä½¿ç”¨ n8n ç¯å¢ƒå˜é‡**:
```bash
# .env æ–‡ä»¶
OPENAI_API_KEY=sk-xxx
NOTION_API_KEY=secret-xxx
DATABASE_URL=postgres://...

# n8n ä¸­å¼•ç”¨
{{ $env.OPENAI_API_KEY }}
```

**æ•æ„Ÿæ•°æ®å¤„ç†**:
- æ°¸è¿œä¸è¦åœ¨ Git ä¸­æäº¤ API Keys
- ä½¿ç”¨ n8n å‡­è¯ç³»ç»Ÿ
- ä¸åŒç¯å¢ƒä½¿ç”¨ä¸åŒå‡­è¯

### æ•°æ®éªŒè¯

**è¾“å…¥éªŒè¯**:
```javascript
// Code èŠ‚ç‚¹éªŒè¯è¾“å…¥
if (!$json.userId) {
  throw new Error('userId is required');
}
if (typeof $json.userId !== 'string') {
  throw new Error('userId must be a string');
}
return $input.all();
```

### è°ƒè¯•æŠ€å·§

**1. ä½¿ç”¨ Set èŠ‚ç‚¹è®°å½•ä¸­é—´çŠ¶æ€**:
```
[Process] â”€â”€â–º [Set: debug_step1] â”€â”€â–º [Next Step]
                    â”‚
                    â””â”€â”€â”€ $json.debug = {...}
```

**2. æ‰§è¡Œæ—¥å¿—**:
```
[Code] â”€â”€â–º console.log('Current data:', JSON.stringify($json))
```

**3. å•èŠ‚ç‚¹æµ‹è¯•**:
- å³é”®èŠ‚ç‚¹ â†’ "Execute Node"
- æŸ¥çœ‹å•ä¸ªèŠ‚ç‚¹è¾“å‡º

---

## [Level 5] è¿›é˜¶å†…å®¹

### æ€§èƒ½ä¼˜åŒ–

**1. å¹¶è¡Œå¤„ç†**:
```
        â”Œâ”€â”€â–º [Process A] â”€â”€â”
[Data] â”€â”¼â”€â”€â–º [Process B] â”€â”€â”¼â”€â”€â–º [Aggregate]
        â””â”€â”€â–º [Process C] â”€â”€â”˜
```

**2. æ‰¹é‡å¤„ç†**:
```
[Loop: 100] â”€â”€â–º [Process Batch: 10] â”€â”€â–º [Save]
```

**3. ç¼“å­˜ç­–ç•¥**:
```javascript
// ä½¿ç”¨å¤–éƒ¨ç¼“å­˜
[Redis] â”€â”€â–º check cache â”€â”€â–º hit â”€â”€â–º return
                      â”‚
                      miss
                      â”‚
                      â–¼
                   [Process]
                      â”‚
                      â–¼
                   [Save Cache]
```

### å®‰å…¨æœ€ä½³å®è·µ

**1. å‡­è¯ç®¡ç†**:
- ä½¿ç”¨ n8n å†…ç½®å‡­è¯å­˜å‚¨
- å®šæœŸè½®æ¢ API Keys
- é™åˆ¶å‡­è¯æƒé™èŒƒå›´

**2. æ•°æ®éšç§**:
- æ•æ„Ÿæ•°æ®åŠ å¯†å­˜å‚¨
- æ—¥å¿—ä¸­éšè—æ•æ„Ÿå­—æ®µ
- éµå®ˆ GDPR/CCPA

**3. è®¿é—®æ§åˆ¶**:
- é…ç½® n8n ç”¨æˆ·è®¤è¯
- ä½¿ç”¨ API Key è®¿é—®ç«¯ç‚¹
- é™åˆ¶å·¥ä½œæµæ‰§è¡Œæƒé™

### ç›‘æ§å’Œå‘Šè­¦

**å…³é”®æŒ‡æ ‡**:
- å·¥ä½œæµæ‰§è¡Œæ—¶é—´
- å¤±è´¥ç‡
- API è°ƒç”¨æ¬¡æ•°
- èµ„æºä½¿ç”¨

**å‘Šè­¦è®¾ç½®**:
```
[Workflow Error] â”€â”€â–º [Send to Slack]
[Performance Threshold] â”€â”€â–º [Email Alert]
```

### æµ‹è¯•ç­–ç•¥

**1. å•å…ƒæµ‹è¯•**:
```
[Test Data] â”€â”€â–º [Subworkflow] â”€â”€â–º [Assert Output]
```

**2. é›†æˆæµ‹è¯•**:
```
[Mock API] â”€â”€â–º [Main Workflow] â”€â”€â–º [Verify Result]
```

**3. ç«¯åˆ°ç«¯æµ‹è¯•**:
```
[Real Trigger] â”€â”€â–º [Full Workflow] â”€â”€â–º [Check Final State]
```

### å¸¸è§é™·é˜±

| é™·é˜± | é—®é¢˜ | è§£å†³æ–¹æ¡ˆ |
|------|------|----------|
| ç¡¬ç¼–ç å€¼ | éš¾ä»¥ç»´æŠ¤ | ä½¿ç”¨ç¯å¢ƒå˜é‡ |
| è¿‡å¤§å·¥ä½œæµ | éš¾ä»¥è°ƒè¯• | æ‹†åˆ†ä¸ºå­å·¥ä½œæµ |
| å¿½ç•¥é”™è¯¯ | é™é»˜å¤±è´¥ | æ·»åŠ é”™è¯¯å¤„ç† |
| æ— æ–‡æ¡£ | éš¾ä»¥ç†è§£ | æ·»åŠ æ³¨é‡Šå’Œæ–‡æ¡£ |
| é‡å¤ä»£ç  | ç»´æŠ¤å›°éš¾ | æå–ä¸ºå­å·¥ä½œæµ |

### å·¥ä½œæµæ¨¡æ¿

**æ ‡å‡†å·¥ä½œæµç»“æ„**:
```
1. é…ç½®èŠ‚ç‚¹ (Set)
2. è¾“å…¥éªŒè¯ (Code/Filter)
3. æ ¸å¿ƒé€»è¾‘ (Subworkflow)
4. é”™è¯¯å¤„ç† (If/Error Trigger)
5. è¾“å‡ºæ ¼å¼åŒ– (Set)
6. æ—¥å¿—è®°å½• (HTTP/Webhook)
```

### ç”Ÿäº§æ£€æŸ¥æ¸…å•

éƒ¨ç½²å‰æ£€æŸ¥ï¼š
- [ ] æ‰€æœ‰ç¯å¢ƒå˜é‡å·²é…ç½®
- [ ] å‡­è¯å·²æ­£ç¡®è®¾ç½®
- [ ] é”™è¯¯å¤„ç†å·²æ·»åŠ 
- [ ] æµ‹è¯•å·²é€šè¿‡
- [ ] æ–‡æ¡£å·²æ›´æ–°
- [ ] ç‰ˆæœ¬å·²æ ‡è®°
- [ ] ç›‘æ§å·²é…ç½®
- [ ] å›æ»šè®¡åˆ’å·²å‡†å¤‡

### ç›¸å…³èµ„æº

**ç›¸å…³ Episode**:
- [Episode 1](../episode_1/) - AI Agent åŸºç¡€
- [Episode 4](../episode_4/) - å­å·¥ä½œæµ
- [Episode 5](../episode_5/) - å¤æ‚å·¥ä½œæµ

**å¤–éƒ¨èµ„æº**:
- [n8n å®˜æ–¹æ–‡æ¡£](https://docs.n8n.io/)
- [n8n ç¤¾åŒºè®ºå›](https://community.n8n.io/)
- [n8n GitHub](https://github.com/n8n-io/n8n)

---

## èµ„æºä¸‹è½½

### n8n å·¥ä½œæµæ–‡ä»¶

æœ¬é›†ä¸»è¦è®²è§£æœ€ä½³å®è·µï¼Œå¯å‚è€ƒå…¶ä»–é›†çš„å·¥ä½œæµæ–‡ä»¶ã€‚

---

## è§‚çœ‹è§†é¢‘

[![Don't build another n8n workflow until you watch this: practical tips and tricks](https://img.youtube.com/vi/mCtQ_H-4aGA/0.jpg)](https://www.youtube.com/watch?v=mCtQ_H-4aGA)

**æ—¶é•¿**: ~30 åˆ†é’Ÿ | **æ›´æ–°æ—¥æœŸ**: 2025-01-17

---

## ç¤¾åŒºæ”¯æŒ

- [Skool ç¤¾åŒº](https://www.skool.com/ai-agents-az/about?gw10)

---

## å¯¼èˆª

| ä½ çš„éœ€æ±‚ | å»ºè®®é˜…è¯» |
|----------|----------|
| å¿«é€Ÿäº†è§£æœ¬é›†å†…å®¹ | Level 1 |
| å†³å®šæ˜¯å¦å­¦ä¹ æœ¬é›† | Level 1-2 |
| å­¦ä¹ ç»„ç»‡è§„èŒƒ | Level 3 |
| å­¦ä¹ æ„å»ºæŠ€å·§ | Level 4 |
| å­¦ä¹ è¿›é˜¶ä¸»é¢˜ | Level 5 |

---

**Episode**: 10 | **ç‰ˆæœ¬**: v2.0 (åˆ†å±‚è§£é‡Šç‰ˆ) | **æœ€åæ›´æ–°**: 2025-01-17

**æ ‡ç­¾**: n8n, best practices, workflow design, production, development, architecture
