# Episode 40: Flux.2[dev] with n8n

> AI Agents A-Z - ç”¨ n8n æ„å»ºå®ç”¨çš„ AI Agent
> éš¾åº¦: â­â­ | é¢„ä¼°æ—¶é—´: 30 åˆ†é’Ÿ

---

## [Level 1] è¿™ä¸€é›†åœ¨åšä»€ä¹ˆï¼Ÿ

æœ¬é›†æ•™ä½ ç”¨ n8n é›†æˆ **Flux.2[dev]** - Black Forest Labs æœ€æ–°å‘å¸ƒçš„å¼ºå¤§ AI å›¾åƒç”Ÿæˆæ¨¡å‹ã€‚

**ä¸€å¥è¯**ï¼šåƒ"å›¾åƒé­”æ³•å¸ˆ"ä¸€æ ·ï¼Œç”¨æ–‡å­—ç”Ÿæˆå›¾åƒï¼Œæˆ–ç”¨å›¾åƒ+æç¤ºè¯è½¬æ¢å›¾åƒã€‚

**é€‚ç”¨åœºæ™¯**ï¼š
- æ–‡å­—ç”Ÿæˆå›¾åƒï¼ˆText to Imageï¼‰- ä½¿ç”¨ Cloudflare Workers AI
- å›¾åƒè½¬æ¢ï¼ˆImage to Imageï¼‰- ä½¿ç”¨ Fal.ai
- åˆ›æ„è®¾è®¡å’ŒåŸå‹åˆ¶ä½œ

> ğŸ’¡ **å¿«é€Ÿåˆ¤æ–­**ï¼šå¦‚æœä½ æƒ³ä½“éªŒ**æœ€æ–°æœ€å¼ºçš„ Flux.2[dev]**ï¼Œè¿™ä¸€é›†é€‚åˆä½ ã€‚
> æƒ³äº†è§£æ›´å¤šï¼Ÿç»§ç»­é˜…è¯» [Level 2]ã€‚

---

## [Level 2] æ ¸å¿ƒæ¦‚å¿µ

### ä½ ä¼šå­¦åˆ°ä»€ä¹ˆ

| åºå· | æ¦‚å¿µ | è¯´æ˜ |
|------|------|------|
| 1 | **Flux.2[dev]** | Black Forest Labs æœ€æ–°çš„å¼€æºå›¾åƒç”Ÿæˆæ¨¡å‹ |
| 2 | **Cloudflare Workers AI** | æ–‡å­—ç”Ÿæˆå›¾åƒï¼Œæœ‰å…è´¹é¢åº¦ |
| 3 | **Fal.ai å­å·¥ä½œæµ** | å›¾åƒåˆ°å›¾åƒè½¬æ¢ |
| 4 | **n8n Switch èŠ‚ç‚¹** | æ¡ä»¶åˆ†æ”¯ï¼Œé€‰æ‹©ä¸åŒçš„æœåŠ¡ |

### æ¶‰åŠçš„ n8n èŠ‚ç‚¹

| èŠ‚ç‚¹ç±»å‹ | ç”¨é€” | æ–°æ‰‹å‹å¥½åº¦ |
|----------|------|------------|
| Form Trigger | æ”¶é›†ç”¨æˆ·é€‰æ‹© | â­ ç®€å• |
| Switch | æ¡ä»¶åˆ†æ”¯ | â­â­ ä¸­ç­‰ |
| HTTP Request | è°ƒç”¨ API | â­â­ ä¸­ç­‰ |
| Convert to File | å¤„ç†å›¾åƒæ•°æ® | â­ ç®€å• |

### æ¶‰åŠçš„å¤–éƒ¨æœåŠ¡

| æœåŠ¡ | å…è´¹é¢åº¦ | éš¾åº¦ | å®˜ç½‘ |
|------|----------|------|------|
| **Cloudflare Workers AI** | æ¯æœˆ 10,000 æ¬¡è¯·æ±‚ | â­â­ | [cloudflare.com](https://dash.cloudflare.com) |
| **Fal.ai** | æŒ‰ä½¿ç”¨ä»˜è´¹ | â­â­ | [fal.ai](https://fal.ai/) |
| **Flux.2[dev]** | é€šè¿‡ä»¥ä¸ŠæœåŠ¡è®¿é—® | â­ | [blackforestlabs.ai](https://blackforestlabs.ai/) |

> ğŸ’¡ **äº†è§£å¤Ÿäº†ï¼Ÿ** çŸ¥é“å­¦ä»€ä¹ˆå°±å¯ä»¥å¼€å§‹ã€‚ç»§ç»­é˜…è¯» [Level 3] äº†è§£å·¥ä½œæµç»“æ„ã€‚

---

## [Level 3] å·¥ä½œæµç»“æ„

### å·¥ä½œæµæ¦‚è§ˆå›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                "Flux.2[dev] æµ‹è¯•" å·¥ä½œæµ                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  [Form Trigger] â”€â”€â–º [Switch]                               â”‚
â”‚  ç”¨æˆ·é€‰æ‹©æ¨¡å‹       æ¡ä»¶åˆ†æ”¯                                â”‚
â”‚       â”‚                  â”‚                                  â”‚
â”‚       â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚       â”‚         â”‚                 â”‚                         â”‚
â”‚       â”‚         â–¼                 â–¼                         â”‚
â”‚       â”‚   [Cloudflare]    [Fal.ai]                         â”‚
â”‚       â”‚   Textâ†’Image       Imageâ†’Image                      â”‚
â”‚       â”‚         â”‚                 â”‚                         â”‚
â”‚       â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚       â”‚                  â”‚                                  â”‚
â”‚       â–¼                  â–¼                                  â”‚
â”‚   [è¿”å›ç”Ÿæˆçš„å›¾åƒæ–‡ä»¶]                                       â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å­å·¥ä½œæµè¯´æ˜

**Cloudflare å­å·¥ä½œæµ** (Text to Image):
```
[Form] â†’ [HTTP Request to Workers AI] â†’ [Convert to File]
```

**Fal.ai å­å·¥ä½œæµ** (Image to Image):
```
[Form] â†’ [Upload Image] â†’ [Call Fal.ai API] â†’ [Convert to File]
```

### æ•°æ®æµ

```
ç”¨æˆ·é€‰æ‹© Cloudflare:
  è¾“å…¥æç¤ºè¯ â†’ Workers AI â†’ Flux.2ç”Ÿæˆ â†’ è¿”å›å›¾åƒ

ç”¨æˆ·é€‰æ‹© Fal.ai:
  ä¸Šä¼ å›¾åƒ + æç¤ºè¯ â†’ Fal.ai â†’ Flux.2è½¬æ¢ â†’ è¿”å›å›¾åƒ
```

### èŠ‚ç‚¹è¯´æ˜

| èŠ‚ç‚¹ | ç±»å‹ | é…ç½®è¦ç‚¹ | æ•°æ®è¾“å‡º |
|------|------|----------|----------|
| **On form submission** | Form Trigger | å•é€‰ï¼šCloudflare æˆ– Fal.ai | ç”¨æˆ·é€‰æ‹© |
| **Switch** | Switch | æ ¹æ®é€‰æ‹©åˆ†æ”¯ | è·¯ç”±åˆ°å¯¹åº”å­å·¥ä½œæµ |
| **Cloudflare sub-workflow** | HTTP Request | è°ƒç”¨ Workers AI API | å›¾åƒæ•°æ® |
| **Fal.ai sub-workflow** | HTTP Request | ä¸Šä¼ å›¾åƒ+æç¤ºè¯ | å›¾åƒæ•°æ® |
| **Convert to File** | Convert to File | è½¬æ¢ä¸ºå¯ä¸‹è½½æ–‡ä»¶ | PNG/WEBP |

> ğŸ’¡ **å‡†å¤‡å°±ç»ªï¼Ÿ** ç†è§£å·¥ä½œæµç»“æ„åï¼Œç»§ç»­é˜…è¯» [Level 4] å¼€å§‹æ„å»ºã€‚

---

## [Level 4] æ„å»ºæ­¥éª¤

### å‰ç½®å‡†å¤‡

åœ¨å¼€å§‹ä¹‹å‰ï¼Œè¯·ç¡®ä¿ï¼š

- [ ] n8n å·²å®‰è£…å¹¶è¿è¡Œï¼ˆè®¿é—® http://localhost:5678ï¼‰
- [ ] Cloudflare è´¦å·å·²åˆ›å»ºï¼Œå¹¶å¯ç”¨ Workers AI
- [ ] Fal.ai è´¦å·å·²åˆ›å»ºï¼ˆ[fal.ai](https://fal.ai/dashboard/keys)ï¼‰
- [ ] å·²è·å–å„è‡ªçš„ API Key

### æ­¥éª¤ 1: å¯¼å…¥ä¸»å·¥ä½œæµ

**ç›®æ ‡**: å¯¼å…¥ Flux.2[dev] æµ‹è¯•å·¥ä½œæµ

**æ“ä½œ**:

1. åœ¨ n8n ä¸­ç‚¹å‡»å³ä¸Šè§’ **"..."** èœå•
2. é€‰æ‹© **"Import from File"**
3. é€‰æ‹© `workflow_test_flux2.json`

**éªŒè¯**: å·¥ä½œæµåº”è¯¥æ˜¾ç¤ºåœ¨ç”»å¸ƒä¸Šï¼ŒåŒ…å«è¡¨å•è§¦å‘å™¨å’Œ Switch èŠ‚ç‚¹

---

### æ­¥éª¤ 2: é…ç½® Cloudflare Workers AI

**ç›®æ ‡**: è®¾ç½®æ–‡å­—ç”Ÿæˆå›¾åƒåŠŸèƒ½

**æ“ä½œ**:

1. ç‚¹å‡» **"Flux.2[dev] on Cloudflare"** å­å·¥ä½œæµ
2. æ‰¾åˆ° HTTP Request èŠ‚ç‚¹
3. é…ç½® Cloudflare API:
   - **Method**: POST
   - **URL**: `https://api.cloudflare.com/client/v4/accounts/{account_id}/ai/run/@cf/black-forest-labs/flux-2-dev`
   - **Headers**: æ·»åŠ  `Authorization: Bearer {API_TOKEN}`
4. é…ç½®è¯·æ±‚ Body:
```json
{
  "prompt": "{{ $json.prompt }}",
  "image_size": "square"
}
```

**éªŒè¯**: ç¡®ä¿ API Token å’Œ Account ID æ­£ç¡®

---

### æ­¥éª¤ 3: é…ç½® Fal.ai å­å·¥ä½œæµ

**ç›®æ ‡**: è®¾ç½®å›¾åƒåˆ°å›¾åƒè½¬æ¢åŠŸèƒ½

**æ“ä½œ**:

1. ç‚¹å‡» **"Flux.2[dev] on Fal.ai"** å­å·¥ä½œæµ
2. æ‰¾åˆ° Fal.ai HTTP Request èŠ‚ç‚¹
3. é…ç½® Fal.ai API:
   - **Method**: POST
   - **URL**: `https://fal.ai/fal-ai/flux-pro/v1.1-ultra`
   - **Headers**: æ·»åŠ  `Authorization: Key {FAL_API_KEY}`
4. é…ç½®è¯·æ±‚ Body:
```json
{
  "image_url": "{{ $json.image_url }}",
  "prompt": "{{ $json.prompt }}"
}
```

**éªŒè¯**: ç¡®ä¿ Fal.ai API Key å·²é…ç½®

---

### æ­¥éª¤ 4: æ¿€æ´»å¹¶æµ‹è¯•å·¥ä½œæµ

**ç›®æ ‡**: ç«¯åˆ°ç«¯éªŒè¯ä¸¤ç§æ–¹å¼

**æ“ä½œ**:

**æµ‹è¯• Cloudflare (Text to Image)**:
1. æ¿€æ´»å·¥ä½œæµ
2. æ‰“å¼€è¡¨å• URL
3. é€‰æ‹© "Flux.2[dev] on Cloudflare"
4. è¾“å…¥æç¤ºè¯ï¼š`"a sunset over mountains"`
5. æäº¤è¡¨å•
6. ç­‰å¾…ç”Ÿæˆç»“æœ

**æµ‹è¯• Fal.ai (Image to Image)**:
1. é‡æ–°æ‰“å¼€è¡¨å•
2. é€‰æ‹© "Flux.2[dev] on Fal.ai"
3. ä¸Šä¼ ä¸€å¼ å›¾ç‰‡
4. è¾“å…¥æç¤ºè¯ï¼š`"make this look like a watercolor painting"`
5. é€‰æ‹©çºµæ¨ªæ¯”
6. æäº¤è¡¨å•
7. ç­‰å¾…è½¬æ¢ç»“æœ

**é¢„æœŸç»“æœ**: ä¸¤ç§æ–¹å¼éƒ½æˆåŠŸè¿”å›ç”Ÿæˆçš„å›¾åƒ

> ğŸ’¡ **éœ€è¦å¸®åŠ©ï¼Ÿ** å¦‚æœé‡åˆ°é—®é¢˜ï¼ŒæŸ¥çœ‹ [Level 5] æ•…éšœæ’é™¤ã€‚

---

## [Level 5] è¿›é˜¶å†…å®¹

### æ”¯æŒçš„çºµæ¨ªæ¯”

| é€‰é¡¹ | å°ºå¯¸ | é€‚ç”¨åœºæ™¯ |
|------|------|----------|
| `square_hd` | 1024x1024 | æ­£æ–¹å½¢é«˜æ¸… |
| `square` | 1024x1024 | æ­£æ–¹å½¢æ ‡å‡† |
| `portrait_4_3` | 832x1104 | ç«–å±ç…§ç‰‡ |
| `portrait_16_9` | 832x1216 | ç«–å±è§†é¢‘ |
| `landscape_4_3` | 1104x832 | æ¨ªå±ç…§ç‰‡ |
| `landscape_16_9` | 1216x832 | æ¨ªå±è§†é¢‘ |

### Flux.2[dev] vs Flux.1

| ç‰¹æ€§ | Flux.2[dev] | Flux.1 |
|------|-------------|-------|
| **è´¨é‡** | æ›´é«˜ | é«˜ |
| **é€Ÿåº¦** | æ›´å¿« | å¿« |
| **æç¤ºè¯ç†è§£** | æ›´å¥½ | å¥½ |
| **å¯ç”¨æ€§** | é€šè¿‡ API | å¹¿æ³›å¯ç”¨ |

### Cloudflare å®šä»·

| å¥—é¤ | ä»·æ ¼ | è¯·æ±‚æ•° |
|------|------|--------|
| **å…è´¹** | $0 | 10,000 æ¬¡/æœˆ |
| **Paid** | æŒ‰ä½¿ç”¨ | $0.003/1000 å¼ å›¾ç‰‡ |

### é«˜çº§æç¤ºè¯æŠ€å·§

```json
// åŸºç¡€æç¤ºè¯
"a cat"

// å¢åŠ é£æ ¼
"a cat, oil painting style, vibrant colors"

// æ·»åŠ ç»†èŠ‚
"a cat sitting on a windowsill, golden hour lighting, detailed fur"

// æŒ‡å®šè´¨é‡
"a cat, professional photography, 8k, highly detailed"
```

### æ•…éšœæ’é™¤

| é—®é¢˜ | ç—‡çŠ¶ | å¯èƒ½åŸå›  | è§£å†³æ–¹æ¡ˆ |
|------|------|----------|----------|
| Cloudflare è®¤è¯å¤±è´¥ | 401 é”™è¯¯ | API Token é”™è¯¯ | æ£€æŸ¥ Token æ ¼å¼å’Œæƒé™ |
| Fal.ai è¶…æ—¶ | è¯·æ±‚è¶…æ—¶ | å›¾åƒå¤ªå¤§æˆ–æœåŠ¡å™¨å¿™ | å‡å°å›¾åƒå°ºå¯¸ï¼Œé‡è¯• |
| Switch ä¸å·¥ä½œ | ä¸¤è·¯éƒ½ä¸è¾“å‡º | æ¡ä»¶è¡¨è¾¾å¼é”™è¯¯ | æ£€æŸ¥ Switch èŠ‚ç‚¹æ¡ä»¶ |
| å›¾åƒè´¨é‡å·® | è¾“å‡ºæ¨¡ç³Š | æç¤ºè¯ä¸å¤Ÿè¯¦ç»† | å¢åŠ æè¿°è¯å’Œé£æ ¼æŒ‡å®š |

### ç”Ÿäº§éƒ¨ç½²æ³¨æ„äº‹é¡¹

**æˆæœ¬ä¼˜åŒ–**:
- Cloudflare å…è´¹é¢åº¦å……è¶³ç”¨äºæµ‹è¯•
- Fal.ai æŒ‰ä½¿ç”¨ä»˜è´¹ï¼Œè®¾ç½®é¢„ç®—é™åˆ¶
- ç¼“å­˜å¸¸ç”¨ç»“æœå‡å°‘é‡å¤è°ƒç”¨

**æ€§èƒ½ä¼˜åŒ–**:
- ä½¿ç”¨å¼‚æ­¥å¤„ç†é¿å…è¶…æ—¶
- è®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´
- è€ƒè™‘ä½¿ç”¨é˜Ÿåˆ—å¤„ç†å¤§é‡è¯·æ±‚

**å®‰å…¨å»ºè®®**:
- ä½¿ç”¨ç¯å¢ƒå˜é‡å­˜å‚¨ API Keys
- é™åˆ¶å·¥ä½œæµçš„å…¬å¼€è®¿é—®
- å®šæœŸè½®æ¢ API å‡­è¯

### ç›¸å…³èµ„æº

**ç›¸å…³ Episode**:
- [Episode 41](../episode_41/) - Z-Image-Turbo å…è´¹æ–¹æ¡ˆ
- [Episode 24](../episode_24/) - Modal å›¾åƒç”Ÿæˆ
- [Episode 19](../episode_19/) - Flux.1 Kontext

**å¤–éƒ¨èµ„æº**:
- [Cloudflare Workers AI æ–‡æ¡£](https://developers.cloudflare.com/workers-ai)
- [Fal.ai æ–‡æ¡£](https://docs.fal.ai/)
- [Flux.2 å…¬å‘Š](https://blackforestlabs.ai/2024/12/17/flux-dev.html)

---

## èµ„æºä¸‹è½½

### n8n å·¥ä½œæµæ–‡ä»¶

ä¸‹è½½å¹¶å¯¼å…¥åˆ° n8nï¼š

- [workflow_test_flux2.json](./workflow_test_flux2.json) - ä¸»å·¥ä½œæµ
- [subworkflow_cloudflare.json](./subworkflow_cloudflare.json) - Cloudflare å­å·¥ä½œæµ
- [subworkflow_fal.json](./subworkflow_fal.json) - Fal.ai å­å·¥ä½œæµ

**å¯¼å…¥æ–¹æ³•**:
1. åœ¨ n8n ä¸­ç‚¹å‡»å³ä¸Šè§’ "..." èœå•
2. é€‰æ‹© "Import from File"
3. é€‰æ‹©ä¸‹è½½çš„ JSON æ–‡ä»¶

---

## è§‚çœ‹è§†é¢‘

[![Flux.2 is out - here's how to use it in n8n (free workflow)
](https://img.youtube.com/vi/Wlc7j26EiJc/0.jpg)](https://www.youtube.com/watch?v=Wlc7j26EiJc)

**æ—¶é•¿**: ~12 åˆ†é’Ÿ | **æ›´æ–°æ—¥æœŸ**: 2025-01-16

---

## ç¤¾åŒºæ”¯æŒ

é‡åˆ°é—®é¢˜ï¼ŸåŠ å…¥ç¤¾åŒºè·å–å¸®åŠ©ï¼š

- [Skool ç¤¾åŒº](https://www.skool.com/ai-agents-az/about)
- è·å– Premium ç‰ˆæœ¬å·¥ä½œæµ

---

## å¯¼èˆª

| ä½ çš„éœ€æ±‚ | å»ºè®®é˜…è¯» |
|----------|----------|
| å¿«é€Ÿäº†è§£æœ¬é›†å†…å®¹ | Level 1 |
| å†³å®šæ˜¯å¦å­¦ä¹ æœ¬é›† | Level 1-2 |
| ç†è§£å·¥ä½œæµåŸç† | Level 3 |
| è·Ÿéšæ•™ç¨‹æ„å»º | Level 4 |
| æ’æŸ¥é—®é¢˜/ç”Ÿäº§éƒ¨ç½² | Level 5 |

---

**Episode**: 40 | **ç‰ˆæœ¬**: v2.0 (åˆ†å±‚è§£é‡Šç‰ˆ) | **æœ€åæ›´æ–°**: 2025-01-16

**æ ‡ç­¾**: n8n, Flux.2, Cloudflare, Fal.ai, image generation, AI art
