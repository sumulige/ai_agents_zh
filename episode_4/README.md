# Episode 4: Deep Research Agent with Google Programmable Search

> AI Agents A-Z - ç”¨ n8n æ„å»ºå®ç”¨çš„ AI Agent
> éš¾åº¦: â­â­â­ | é¢„ä¼°æ—¶é—´: 50 åˆ†é’Ÿ

---

## [Level 1] è¿™ä¸€é›†åœ¨åšä»€ä¹ˆï¼Ÿ

æœ¬é›†æ•™ä½ ç”¨ n8n æ„å»ºä¸€ä¸ª**æ·±åº¦ç ”ç©¶å­å·¥ä½œæµ**ï¼Œä½¿ç”¨ Google Programmable Search è¿›è¡Œæ™ºèƒ½æœç´¢å’Œå†…å®¹æå–ã€‚

**ä¸€å¥è¯**ï¼šåƒ"ç ”ç©¶åŠ©æ‰‹"ä¸€æ ·ï¼Œè‡ªåŠ¨æœç´¢ã€æŠ“å–ã€æ€»ç»“ç½‘é¡µå†…å®¹ï¼Œä¸ºä½ æä¾›æ·±åº¦ç ”ç©¶ã€‚

**é€‚ç”¨åœºæ™¯**ï¼š
- å†…å®¹åˆ›ä½œå‰çš„æ·±åº¦ç ”ç©¶
- ç«å“åˆ†æå’Œå¸‚åœºè°ƒç ”
- è‡ªåŠ¨åŒ–ä¿¡æ¯æ”¶é›†å’Œæ€»ç»“

> ğŸ’¡ **å¿«é€Ÿåˆ¤æ–­**ï¼šå¦‚æœä½ éœ€è¦**è‡ªåŠ¨åŒ–ç½‘ç»œç ”ç©¶å’Œä¿¡æ¯æ”¶é›†**ï¼Œè¿™ä¸€é›†é€‚åˆä½ ã€‚
> æƒ³äº†è§£æ›´å¤šï¼Ÿç»§ç»­é˜…è¯» [Level 2]ã€‚

---

## [Level 2] æ ¸å¿ƒæ¦‚å¿µ

### ä½ ä¼šå­¦åˆ°ä»€ä¹ˆ

| åºå· | æ¦‚å¿µ | è¯´æ˜ |
|------|------|------|
| 1 | **å­å·¥ä½œæµ** | å¯è¢«å…¶ä»–å·¥ä½œæµè°ƒç”¨çš„å¯å¤ç”¨ç»„ä»¶ |
| 2 | **Google Programmable Search** | è‡ªå®šä¹‰æœç´¢å¼•æ“ API |
| 3 | **LLM æœç´¢è¯ç”Ÿæˆ** | AI ç”Ÿæˆå¤šæ ·åŒ–æœç´¢æŸ¥è¯¢ |
| 4 | **HTML å†…å®¹æå–** | ä»ç½‘é¡µæå–æ­£æ–‡å†…å®¹ |
| 5 | **Markdown è½¬æ¢** | å°† HTML è½¬ä¸º Markdown æ ¼å¼ |
| 6 | **LLM å†…å®¹æ€»ç»“** | AI æ€»ç»“å’Œè¿‡æ»¤ç›¸å…³å†…å®¹ |

### æ¶‰åŠçš„ n8n èŠ‚ç‚¹

| èŠ‚ç‚¹ç±»å‹ | ç”¨é€” | æ–°æ‰‹å‹å¥½åº¦ |
|----------|------|------------|
| Execute Workflow Trigger | å­å·¥ä½œæµå…¥å£ | â­â­ ä¸­ç­‰ |
| HTTP Request | è°ƒç”¨ Google API | â­â­ ä¸­ç­‰ |
| Split Out | åˆ†å‰²æ•°ç»„å¤„ç† | â­ ç®€å• |
| HTML Extract | æå–ç½‘é¡µå†…å®¹ | â­â­ ä¸­ç­‰ |
| Markdown | HTML è½¬ Markdown | â­â­ ä¸­ç­‰ |
| LLM Chain | ç”Ÿæˆæœç´¢è¯/æ€»ç»“ | â­â­ ä¸­ç­‰ |
| Structured Output Parser | JSON è¾“å‡º | â­â­ ä¸­ç­‰ |
| Filter | è¿‡æ»¤å†…å®¹ | â­â­ ä¸­ç­‰ |
| Aggregate | èšåˆç»“æœ | â­â­ ä¸­ç­‰ |

### æ¶‰åŠçš„å¤–éƒ¨æœåŠ¡

| æœåŠ¡ | å…è´¹é¢åº¦ | éš¾åº¦ | å®˜ç½‘ |
|------|----------|------|------|
| **Google Custom Search API** | 100 æ¬¡/å¤©å…è´¹ | â­â­ | [developers.google.com](https://developers.google.com/custom-search/v1/using_rest) |
| **OpenAI** | æŒ‰ä½¿ç”¨ä»˜è´¹ | â­ | [openai.com](https://openai.com/) |

> ğŸ’¡ **äº†è§£å¤Ÿäº†ï¼Ÿ** çŸ¥é“å­¦ä»€ä¹ˆå°±å¯ä»¥å¼€å§‹ã€‚ç»§ç»­é˜…è¯» [Level 3] äº†è§£å·¥ä½œæµç»“æ„ã€‚

---

## [Level 3] å·¥ä½œæµç»“æ„

### å·¥ä½œæµæ¦‚è§ˆå›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              "Google Deep Research" å­å·¥ä½œæµ                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  [Execute Workflow Trigger] â”€â”€â–º æ¥æ”¶è°ƒç”¨å‚æ•°                 â”‚
â”‚  è¾“å…¥: context, top_results, num_search_terms                â”‚
â”‚       â”‚                                                     â”‚
â”‚       â–¼                                                     â”‚
â”‚  [Configuration] â”€â”€â–º è®¾ç½® API å¯†é’¥å’Œå‚æ•°                      â”‚
â”‚       â”‚                                                     â”‚
â”‚       â–¼                                                     â”‚
â”‚  [LLM Chain] â”€â”€â–º ç”Ÿæˆæœç´¢è¯                                 â”‚
â”‚  åŸºäºä¸Šä¸‹æ–‡åˆ›å»ºå¤šæ ·åŒ–çš„æœç´¢æŸ¥è¯¢                               â”‚
â”‚       â”‚                                                     â”‚
â”‚       â–¼                                                     â”‚
â”‚  [Split Out] â”€â”€â–º åˆ†ç¦»æ¯ä¸ªæœç´¢è¯                             â”‚
â”‚       â”‚                                                     â”‚
â”‚       â–¼                                                     â”‚
â”‚  [HTTP Request] â”€â”€â–º Google Custom Search API                â”‚
â”‚  æœç´¢ reddit.com ä¸Šçš„å†…å®¹                                    â”‚
â”‚       â”‚                                                     â”‚
â”‚       â–¼                                                     â”‚
â”‚  [Filter] â”€â”€â–º è¿‡æ»¤æœ‰æ•ˆç»“æœ                                  â”‚
â”‚       â”‚                                                     â”‚
â”‚       â–¼                                                     â”‚
â”‚  [Split Out1] â”€â”€â–º åˆ†ç¦»æ¯ä¸ªæœç´¢ç»“æœ                          â”‚
â”‚       â”‚                                                     â”‚
â”‚       â–¼                                                     â”‚
â”‚  [HTML Extract] â”€â”€â–º æå–ç½‘é¡µæ­£æ–‡                            â”‚
â”‚       â”‚                                                     â”‚
â”‚       â–¼                                                     â”‚
â”‚  [Markdown] â”€â”€â–º è½¬æ¢ä¸º Markdown                             â”‚
â”‚       â”‚                                                     â”‚
â”‚       â–¼                                                     â”‚
â”‚  [LLM Chain] â”€â”€â–º æ€»ç»“å†…å®¹                                  â”‚
â”‚       â”‚                                                     â”‚
â”‚       â–¼                                                     â”‚
â”‚  [LLM Chain] â”€â”€â–º åˆ¤æ–­ç›¸å…³æ€§                                 â”‚
â”‚       â”‚                                                     â”‚
â”‚       â–¼                                                     â”‚
â”‚  [Filter1] â”€â”€â–º åªä¿ç•™ç›¸å…³å†…å®¹                               â”‚
â”‚       â”‚                                                     â”‚
â”‚       â–¼                                                     â”‚
â”‚  [Aggregate] â”€â”€â–º èšåˆæ‰€æœ‰ç ”ç©¶ç»“æœ                           â”‚
â”‚       â”‚                                                     â”‚
â”‚       â–¼                                                     â”‚
â”‚  è¿”å› research_results                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•°æ®æµ

```
è¾“å…¥: research context
    â”‚
    â”œâ”€â”€â–º LLM ç”Ÿæˆæœç´¢è¯
    â”‚     â””â”€â”€â”€ å¤šæ ·åŒ–çš„æŸ¥è¯¢
    â”‚
    â”œâ”€â”€â–º Google Search API
    â”‚     â””â”€â”€â”€ æœç´¢ç»“æœ (title, link, snippet)
    â”‚
    â”œâ”€â”€â–º æŠ“å–ç½‘é¡µå†…å®¹
    â”‚     â””â”€â”€â”€ HTML æå– â†’ Markdown
    â”‚
    â”œâ”€â”€â–º LLM æ€»ç»“
    â”‚     â””â”€â”€â”€ æ¯é¡µå†…å®¹çš„ç®€è¦æ€»ç»“
    â”‚
    â”œâ”€â”€â–º LLM åˆ¤æ–­ç›¸å…³æ€§
    â”‚     â””â”€â”€â”€ æ˜¯å¦ä¸ä¸Šä¸‹æ–‡ç›¸å…³
    â”‚
    â””â”€â”€â–º è¿”å›ç»“æœ
          â””â”€â”€â”€ research_results: [{summary, relevance}]
```

### èŠ‚ç‚¹è¯´æ˜

| èŠ‚ç‚¹ | ç±»å‹ | é…ç½®è¦ç‚¹ | æ•°æ®è¾“å‡º |
|------|------|----------|----------|
| **When Executed by Another Workflow** | Execute Workflow | å®šä¹‰è¾“å…¥å‚æ•° | è§¦å‘ä¿¡å· |
| **configuration** | Set | è®¾ç½® Google API Key å’Œ CX | é…ç½®å¯¹è±¡ |
| **create search terms** | LLM Chain | ç”Ÿæˆå¤šæ ·åŒ–æœç´¢è¯ | `{search_terms: [...]}` |
| **search on Google** | HTTP Request | Google Custom Search API | æœç´¢ç»“æœ |
| **HTML** | HTML Extract | CSS: `body` | ç½‘é¡µ HTML |
| **Markdown** | Markdown | HTML â†’ Markdown | Markdown æ–‡æœ¬ |
| **summarize content** | LLM Chain | æ€»ç»“ç½‘é¡µå†…å®¹ | `{summary: "..."}` |
| **check relevance** | LLM Chain | åˆ¤æ–­æ˜¯å¦ç›¸å…³ | `{relevant_to_context: true/false}` |
| **Aggregate** | Aggregate | èšåˆåˆ° `research_results` | ç ”ç©¶æ•°ç»„ |

> ğŸ’¡ **å‡†å¤‡å°±ç»ªï¼Ÿ** ç†è§£å·¥ä½œæµç»“æ„åï¼Œç»§ç»­é˜…è¯» [Level 4] å¼€å§‹æ„å»ºã€‚

---

## [Level 4] æ„å»ºæ­¥éª¤

### å‰ç½®å‡†å¤‡

åœ¨å¼€å§‹ä¹‹å‰ï¼Œè¯·ç¡®ä¿ï¼š

- [ ] n8n å·²å®‰è£…å¹¶è¿è¡Œ
- [ ] OpenAI API Key å·²é…ç½®
- [ ] Google Custom Search API Key å·²è·å–
- [ ] Google Programmable Search Engine å·²åˆ›å»º

### æ­¥éª¤ 1: åˆ›å»º Google Programmable Search Engine

**ç›®æ ‡**: è®¾ç½®è‡ªå®šä¹‰æœç´¢å¼•æ“

**æ“ä½œ**:

1. è®¿é—® [Google Programmable Search Engine](https://programmablesearchengine.google.com/)
2. ç‚¹å‡» **"Add"** åˆ›å»ºæœç´¢å¼•æ“
3. é€‰æ‹©è¦æœç´¢çš„ç½‘ç«™ï¼ˆæˆ–å…¨ç½‘ï¼‰
4. è·å– **Search Engine ID (CX)**

**éªŒè¯**: ä¿å­˜äº† CX å­—ç¬¦ä¸²

---

### æ­¥éª¤ 2: è·å– Google API Key

**ç›®æ ‡**: å¯ç”¨ Custom Search API

**æ“ä½œ**:

1. è®¿é—® [Google Cloud Console](https://console.cloud.google.com/)
2. åˆ›å»ºæ–°é¡¹ç›®æˆ–é€‰æ‹©ç°æœ‰é¡¹ç›®
3. å¯ç”¨ **Custom Search API**
4. åˆ›å»º API Key
5. é™åˆ¶ API Key ä½¿ç”¨ï¼ˆå¯é€‰ï¼‰

**éªŒè¯**: è·å¾—äº† API Key

---

### æ­¥éª¤ 3: å¯¼å…¥å­å·¥ä½œæµ

**ç›®æ ‡**: å¯¼å…¥æ·±åº¦ç ”ç©¶å·¥ä½œæµ

**æ“ä½œ**:

1. åœ¨ n8n ä¸­ç‚¹å‡» **"..."** èœå•
2. é€‰æ‹© **"Import from File"**
3. é€‰æ‹© `google_deep_research.json`

**éªŒè¯**: å·¥ä½œæµæ˜¾ç¤ºä¸ºå­å·¥ä½œæµï¼ˆExecute Workflow Triggerï¼‰

---

### æ­¥éª¤ 4: é…ç½® Google API

**ç›®æ ‡**: è®¾ç½® API å¯†é’¥

**æ“ä½œ**:

1. ç‚¹å‡» **"configuration"** èŠ‚ç‚¹
2. æ›¿æ¢ä»¥ä¸‹å€¼ï¼š
   - `GOOGLE_API_KEY`: ä½ çš„ API Key
   - `GOOGLE_CUSTOM_SEARCH`: ä½ çš„ CX ID

**éªŒè¯**: é…ç½®èŠ‚ç‚¹å·²æ›´æ–°

---

### æ­¥éª¤ 5: é…ç½® LLM æ¨¡å‹

**ç›®æ ‡**: è¿æ¥ OpenAI

**æ“ä½œ**:

1. ç‚¹å‡» **"OpenAI Chat Model"** èŠ‚ç‚¹
2. ç¡®ä¿ä½¿ç”¨ `gpt-4o-mini`ï¼ˆæ›´å¿«æ›´ä¾¿å®œï¼‰
3. éªŒè¯å‡­è¯å·²è¿æ¥

**éªŒè¯**: æ¨¡å‹å·²é€‰æ‹©

---

### æ­¥éª¤ 6: æµ‹è¯•å­å·¥ä½œæµ

**ç›®æ ‡**: ç«¯åˆ°ç«¯éªŒè¯

**æ“ä½œ**:

1. åˆ›å»ºæµ‹è¯•å·¥ä½œæµè°ƒç”¨å­å·¥ä½œæµ
2. è®¾ç½®æµ‹è¯•å‚æ•°ï¼š
   - `context`: "AI agent automation"
   - `top_results`: 3
   - `num_search_terms`: 2
3. æ‰§è¡Œæµ‹è¯•

**é¢„æœŸç»“æœ**:
- è¿”å›ç»“æ„åŒ–çš„ç ”ç©¶ç»“æœ
- æ¯ä¸ªç»“æœåŒ…å« summary å’Œç›¸å…³æ€§

---

### æ­¥éª¤ 7: ä»å…¶ä»–å·¥ä½œæµè°ƒç”¨

**ç›®æ ‡**: é›†æˆåˆ°ä¸»å·¥ä½œæµ

**æ“ä½œ**:

1. åœ¨ä»»ä½•å·¥ä½œæµä¸­æ·»åŠ  **Execute Workflow** èŠ‚ç‚¹
2. é€‰æ‹© "Google Deep Research" å­å·¥ä½œæµ
3. ä¼ å…¥å‚æ•°

**éªŒè¯**: ä¸»å·¥ä½œæµèƒ½æˆåŠŸè°ƒç”¨å¹¶è·å–ç»“æœ

> ğŸ’¡ **éœ€è¦å¸®åŠ©ï¼Ÿ** å¦‚æœé‡åˆ°é—®é¢˜ï¼ŒæŸ¥çœ‹ [Level 5] æ•…éšœæ’é™¤ã€‚

---

## [Level 5] è¿›é˜¶å†…å®¹

### å‚æ•°è¯´æ˜

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| `context` | å¿…éœ€ | ç ”ç©¶ä¸»é¢˜/ä¸Šä¸‹æ–‡ |
| `top_results` | 3 | æ¯æ¬¡æœç´¢è¿”å›çš„ç»“æœæ•° |
| `num_search_terms` | 2 | LLM ç”Ÿæˆçš„æœç´¢è¯æ•°é‡ |

### æœç´¢ç­–ç•¥

**é»˜è®¤è¡Œä¸º**: æœç´¢ `reddit.com`
- é€‚åˆè·å–çœŸå®ç”¨æˆ·è®¨è®º
- é€‚åˆäº§å“åé¦ˆå’Œæ„è§

**ä¿®æ”¹æœç´¢èŒƒå›´**:
```javascript
// åœ¨ HTTP Request èŠ‚ç‚¹ä¸­
siteSearch: "your-domain.com"  // æŒ‡å®šç½‘ç«™
siteSearch: ""                 // å…¨ç½‘æœç´¢
```

### å­å·¥ä½œæµè°ƒç”¨ç¤ºä¾‹

**åœ¨ä¸»å·¥ä½œæµä¸­è°ƒç”¨**:
```javascript
{
  "context": "best practices for n8n workflows",
  "top_results": 5,
  "num_search_terms": 3
}
```

### è¾“å‡ºæ ¼å¼

```json
{
  "research_results": [
    {
      "summary": "ç ”ç©¶å‘ç°...",
      "relevant_to_context": true
    }
  ]
}
```

### æ•…éšœæ’é™¤

| é—®é¢˜ | ç—‡çŠ¶ | å¯èƒ½åŸå›  | è§£å†³æ–¹æ¡ˆ |
|------|------|----------|----------|
| API é…é¢ç”¨å°½ | 429 é”™è¯¯ | è¶…è¿‡æ¯æ—¥é™é¢ | ç­‰å¾…é‡ç½®æˆ–å¢åŠ é…é¢ |
| æ— æœç´¢ç»“æœ | ç©ºç»“æœæ•°ç»„ | æœç´¢è¯å¤ªå…·ä½“ | æ”¾å®½æœç´¢æ¡ä»¶ |
| HTML æå–å¤±è´¥ | ç©ºå†…å®¹ | ç½‘ç«™åçˆ¬è™« | æ·»åŠ  user-agent |
| LLM ç›¸å…³æ€§åˆ¤æ–­ä¸å‡† | ä¿ç•™æ— å…³å†…å®¹ | æç¤ºè¯ä¸å¤Ÿæ¸…æ™° | ä¼˜åŒ–ç›¸å…³æ€§åˆ¤æ–­æç¤º |

### é«˜çº§é…ç½®

**æ·»åŠ æ›´å¤šæœç´¢é€‰é¡¹**:
```javascript
{
  "exactTerms": "ç²¾ç¡®è¯",
  "excludeTerms": "æ’é™¤è¯",
  "dateRestrict": "d7"  // æœ€è¿‘ 7 å¤©
}
```

**æœç´¢ç‰¹å®šç±»å‹**:
- `fileType: "pdf"` - PDF æ–‡ä»¶
- `dateRestrict: "m1"` - æœ€è¿‘ä¸€ä¸ªæœˆ

### ç”Ÿäº§éƒ¨ç½²æ³¨æ„äº‹é¡¹

**é…é¢ç®¡ç†**:
- ç›‘æ§ API ä½¿ç”¨é‡
- å®ç°è¯·æ±‚ç¼“å­˜
- ä½¿ç”¨å¤šä¸ª API Key è½®æ¢

**æˆæœ¬ä¼˜åŒ–**:
- ä½¿ç”¨ `gpt-4o-mini` è€Œé `gpt-4o`
- é™åˆ¶ `num_search_terms`
- åªæŠ“å–å¿…è¦çš„é¡µé¢

**æ€§èƒ½ä¼˜åŒ–**:
- å¹¶è¡Œå¤„ç†å¤šä¸ªæœç´¢è¯
- è®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´
- å®ç°å¢é‡å¤„ç†

### ç›¸å…³èµ„æº

**ç›¸å…³ Episode**:
- [Episode 5](../episode_5/) - åšå®¢å†™ä½œç³»ç»Ÿï¼ˆä½¿ç”¨æ­¤å­å·¥ä½œæµï¼‰
- [Episode 1](../episode_1/) - AI Agent åŸºç¡€
- [Episode 3](../episode_3/) - LinkedIn å¸–å­

**å¤–éƒ¨èµ„æº**:
- [Google Custom Search æ–‡æ¡£](https://developers.google.com/custom-search/v1/using_rest)
- [Programmable Search Engine æ§åˆ¶å°](https://programmablesearchengine.google.com/)

---

## èµ„æºä¸‹è½½

### n8n å·¥ä½œæµæ–‡ä»¶

- [google_deep_research.json](./google_deep_research.json)

---

## è§‚çœ‹è§†é¢‘

[![Smart AI Content Research System: Fully Automated Deep Research](https://img.youtube.com/vi/Ylf58KNIkeU/0.jpg)](https://www.youtube.com/watch?v=Ylf58KNIkeU)

**æ—¶é•¿**: ~30 åˆ†é’Ÿ | **æ›´æ–°æ—¥æœŸ**: 2025-01-17

---

## ç¤¾åŒºæ”¯æŒ

- [Skool ç¤¾åŒº](https://www.skool.com/ai-agents-az/about?gw4)

---

## å¯¼èˆª

| ä½ çš„éœ€æ±‚ | å»ºè®®é˜…è¯» |
|----------|----------|
| å¿«é€Ÿäº†è§£æœ¬é›†å†…å®¹ | Level 1 |
| å†³å®šæ˜¯å¦å­¦ä¹ æœ¬é›† | Level 1-2 |
| ç†è§£å·¥ä½œæµåŸç† | Level 3 |
| è·Ÿéšæ•™ç¨‹æ„å»º | Level 4 |
| æ’æŸ¥é—®é¢˜/ç”Ÿäº§éƒ¨ç½² | Level 5 |

---

**Episode**: 4 | **ç‰ˆæœ¬**: v2.0 (åˆ†å±‚è§£é‡Šç‰ˆ) | **æœ€åæ›´æ–°**: 2025-01-17

**æ ‡ç­¾**: n8n, Google Search, deep research, subworkflow, web scraping, automation
