# 分层解释法示例：什么是 n8n？

> 这是一个简单概念的分层解释示例

---

## [Level 1] 本质

**n8n** 是可视化的乐高积木，用于连接各种服务自动执行任务。

一句话：像搭积木一样搭建自动化流程，不用写代码。

> 💡 **够用了吗？** 知道它是"可视化自动化工具"就够了。继续阅读 [Level 2] 了解核心概念。

---

## [Level 2] 核心概念

### 三个关键概念

| 概念 | 类比 | 说明 |
|------|------|------|
| **节点(Node)** | 一块积木 | 代表一个操作（如发送邮件、调用 API） |
| **连接(Connection)** | 积木间的粘连 | 决定数据如何从一个节点流向下一个 |
| **工作流(Workflow)** | 搭好的整体 | 完整的自动化流程，从触发到结束 |

### 为什么叫 n8n？

n8n = "nudemans" → n8n

名字的由来是德语"八个字母缩写"，简单好记。

> 💡 **了解够了？** 理解这三个概念就懂了 n8n 的原理。继续阅读 [Level 3] 了解工作流结构。

---

## [Level 3] 工作流结构

### 数据流图

```
┌─────────────────────────────────────────────────────────────┐
│                    n8n 工作流结构                             │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  [触发器] ──► [处理节点1] ──► [处理节点2] ──► [输出]        │
│      │           │               │              │          │
│   定时/事件     转换数据        调用API        保存结果      │
│   自动启动     处理逻辑        业务逻辑       最终结果       │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 典型工作流示例

**每天早上发送新闻摘要**:

```
[Cron 每早8点] → [抓取新闻API] → [用GPT总结] → [发送邮件]
```

**新客户跟进**:

```
[Webhook 订单] → [添加到CRM] → [发送欢迎短信] → [创建跟进任务]
```

### 数据在节点间如何传递

```
节点A输出: { "name": "Alice", "email": "alice@example.com" }
    │
    ▼ (连接传递整个 JSON 对象)
节点B接收: {{ $json.name }} → "Alice"
节点B接收: {{ $json.email }} → "alice@example.com"
```

> 💡 **准备就绪？** 看懂结构图后，继续阅读 [Level 4] 开始实际使用。

---

## [Level 4] 快速开始

### 安装 n8n

**方式一：npm 安装**（推荐开发者）
```bash
npm install n8n -g
n8n start
# 访问 http://localhost:5678
```

**方式二：Docker**（推荐生产环境）
```bash
docker run -it --rm \
  -p 5678:5678 \
  n8nio/n8n
```

**方式三：n8n Cloud**（推荐新手）
- 访问 [n8n.cloud](https://n8n.cloud)
- 免费额度：5,000 次执行/月

### 创建第一个工作流

1. 打开 n8n 编辑器
2. 点击 "Add workflow"
3. 添加 "Cron" 节点，设置为每分钟执行
4. 添加 "HTTP Request" 节点，请求 `https://api.github.com/zen`
5. 添加 "No-Op" 节点查看结果
6. 点击 "Execute Workflow" 测试

### 核心操作

| 操作 | 方法 |
|------|------|
| 添加节点 | 左侧面板拖拽或搜索 |
| 连接节点 | 拖动节点右侧的点到另一个节点 |
| 测试节点 | 点击节点上的 "Test step" |
| 执行工作流 | 点击左上角 "Execute Workflow" |

> 💡 **需要精通？** 基本使用没问题了，继续阅读 [Level 5] 了解高级技巧。

---

## [Level 5] 进阶技巧

### 子工作流（Sub-workflows）

将重复的流程提取为子工作流，实现复用：

```
主工作流:
[触发器] → [子工作流: 发送通知] → [完成]

子工作流 "发送通知":
[输入] → [判断渠道] → [发送邮件/Slack/短信]
```

### 错误处理

使用 Error Trigger 节点捕获失败：

```
[主工作流] (失败时) → [Error Trigger] → [发送告警]
```

### 表达式（Expressions）

n8n 支持强大的表达式语法：

```javascript
// 访问数据
{{ $json.name }}

// 数据转换
{{ $json.title.toUpperCase() }}

// 条件判断
{{ $json.age > 18 ? "成年" : "未成年" }}

// 函数调用
{{ $now.format('YYYY-MM-DD') }}
```

### 生产部署建议

| 建议 | 说明 |
|------|------|
| 环境变量 | API Key 使用 `{{$credentials.apiKey}}` |
| 执行历史 | 定期清理旧记录避免数据库膨胀 |
| 监控 | 设置健康检查端点 |
| 备份 | 定期导出工作流 JSON |

### 资源链接

- 官方文档: https://docs.n8n.io
- 社区模板: https://n8n.io/workflows
- YouTube 教程: https://youtube.com/@n8nio

---

**示例完** - 这就是分层解释法的完整应用
